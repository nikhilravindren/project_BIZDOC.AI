{% extends 'base.html' %}
{% load static %}
{% block content %}

    <!-- Main Content -->
    <div id="sidebar" style="position: fixed; top: 6%; left: 0%; height: 100vh; background-color: #2d3748; color: white; width: 12%; transform: translateX(0); transition: transform 0.3s ease;">
        <div style="padding: 24px; padding-left: 50px;">
            <h1 style="font-size: 1.5rem; font-weight: bold;">Menu</h1>
            <ul style="margin-top: 24px; list-style: none; padding: 0;">
                <li><a href="#" style="display: block; padding: 8px; border-radius: 4px; text-decoration: none; color: inherit;" onmouseover="this.style.backgroundColor='#4a5568';" onmouseout="this.style.backgroundColor='';">Doc 1</a></li>
                <li><a href="#" style="display: block; padding: 8px; border-radius: 4px; text-decoration: none; color: inherit;" onmouseover="this.style.backgroundColor='#4a5568';" onmouseout="this.style.backgroundColor='';">Doc 2</a></li>
                <li><a href="#" style="display: block; padding: 8px; border-radius: 4px; text-decoration: none; color: inherit;" onmouseover="this.style.backgroundColor='#4a5568';" onmouseout="this.style.backgroundColor='';">Doc 3</a></li>
                <li><a href="#" style="display: block; padding: 8px; border-radius: 4px; text-decoration: none; color: inherit;" onmouseover="this.style.backgroundColor='#4a5568';" onmouseout="this.style.backgroundColor='';">Doc 4</a></li>
            </ul>
        </div>
    </div>
    
    <!-- Fixed Button to Toggle Sidebar -->
    <button id="toggleSidebarButton" style="position: fixed; top: 9%; left: 0%; z-index: 40; background-color: #2d3748; color: white; padding: 8px; border-radius: 4px;">
        <!-- Hamburger Icon -->
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="width: 24px; height: 24px;">
            <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
    </button>
        <!-- Dashboard Content -->
        <div id="mainContent" style="flex: 1; margin-left: 12%; padding: 24px; overflow-y: auto; transition: margin-left 0.3s ease;">
            <div class="flex justify-between space-x-4">
                <!-- Pie Chart -->
                 
                <div class="w-1/3 bg-gray-800 p-4 rounded-lg shadow-lg">
                    <canvas id="pieChart"></canvas>
                </div>

                <!-- Bar Chart -->
                <div class="w-2/3 bg-gray-800 p-4 rounded-lg shadow-lg">
                    <canvas id="barChart"></canvas>
                </div>
            </div>

            <!-- Analysis Table -->
            <div class="bg-gray-800 p-4 rounded-lg shadow-lg mt-8">
                <h2 class="text-xl font-semibold text-white mb-4">Analysis Table</h2>
                <table class="min-w-full bg-gray-800 text-white">
                    <thead>
                        <tr>
                            <th class="py-2 px-4 border-b border-gray-600">Company</th>
                            <th class="py-2 px-4 border-b border-gray-600">Sector</th>
                            <th class="py-2 px-4 border-b border-gray-600">News</th>
                            <th class="py-2 px-4 border-b border-gray-600">Sentiment</th>
                            <th class="py-2 px-4 border-b border-gray-600">Confidence</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Sample Rows -->
                         {% for i in all %}
                        <tr>
                            <td class="py-2 px-4 border-b border-gray-600">{{i.company.name}}</td>
                            <td class="py-2 px-4 border-b border-gray-600">{{i.company.sector}}</td>
                            <td class="py-2 px-4 border-b border-gray-600">{{i.news|truncatechars:100}}</td>
                            <td class="py-2 px-4 border-b border-gray-600">{{i.sentiment}}</td>
                            <td class="py-2 px-4 border-b border-gray-600">{{i.confidence}}</td>
                        </tr>
                        {% endfor %}
                        
                        <!-- Add more rows as needed -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Pie Chart
        const pieCtx = document.getElementById('pieChart').getContext('2d');
        const pieChart = new Chart(pieCtx, {
            type: 'pie',
            data: {
                labels: [
                {% for i in sentiment %}
                '{{i.sentiment}}',
                {% endfor %}
                ],
                datasets: [{
                    label: 'Company Names',
                    data: [
                        {% for i in sentiment %}
                        {{i.count}},
                        {% endfor %}
                    ],
                    backgroundColor: ['#1f77b4', '#ff7f0e', '#2ca02c']
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false
            }
        });

        // Bar Chart
        const barCtx = document.getElementById('barChart').getContext('2d');
        const barChart = new Chart(barCtx, {
            type: 'bar',
            data: {
                labels: [
                    {% for i in sector %}
                    '{{i.sector}}',
                    {% endfor %}
                ],
                datasets: [{
                    label: 'Time Spent on BizDoc',
                    data: [
                        {% for i in sector %}
                        {{i.count}},
                        {% endfor %}
                    ],
                    backgroundColor: '#1f77b4'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false
            }
        });


        document.getElementById('toggleSidebarButton').addEventListener('click', function() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            
            if (sidebar.style.transform === 'translateX(0%)') {
                sidebar.style.transform = 'translateX(-100%)';
                mainContent.style.marginLeft = '2%';
            } else {
                sidebar.style.transform = 'translateX(0%)';
                mainContent.style.marginLeft = '12%';
            }
        });
        // Placeholder for future database connection
        // TODO: Connect to a database and dynamically populate the table and charts
    </script>
{% endblock content %}